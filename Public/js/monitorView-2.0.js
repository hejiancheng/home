function focusGraphic(){needRefresh&&(myChart.showLoading(),setTimeout(refresh,1e3))}function getQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),o=window.location.search.substr(1).match(e);return null!=o?unescape(o[2]):null}var KKB=new Object;KKB.pageMapMonitor={},KKB.pageMapMonitor.view=function(){this.domTagArr=null,this.myChart,this.domMain,this.needRefresh=!1,this.curTheme,this.echarts,this.option,this.trimData=[],this.trimDataVal=[]},KKB.pageMapMonitor.view.prototype.init=function(t,e){function o(t){if(t.data){if(c.domTagArr)for(var e=0;e<c.domTagArr.length;e++)for(var o=0;o<t.data.length;o++)if(c.domTagArr[e].getAttribute("click_source")==t.data[o].action_name){c.trimData.push({value:t.data[o].count,x:c.getElementLeft(c.domTagArr[e])>0?c.getElementLeft(c.domTagArr[e]):50,y:c.getElementTop(c.domTagArr[e])>0?c.getElementTop(c.domTagArr[e]):50,HREF:c.domTagArr[e].href,W:c.domTagArr[e].offsetWidth,H:c.domTagArr[e].offsetHeight}),c.trimDataVal.push(Number(t.data[o].count)),t.data.splice(o,1);break}if(c.trimData){var r="/assets/kkb_hot_map/echart/echarts";require.config({paths:{echarts:r,"echarts/chart/scatter":r}}),require(["echarts","echarts/chart/scatter"],c.requireCallback)}}}var r=this.getPageArea(),i=document.createElement("div");i.style.height=r.H+"px",i.style.width=r.W+"px",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.zIndex=1e4,i.id="monitorContainer",document.body.appendChild(i),this.domMain=document.getElementById("monitorContainer"),this.domTagArr=document.getElementsByTagName(t[0]);var a=document.getElementsByTagName(t[1]);if(a.length)for(var n=0;n<a.length;n++)if(a[n].getAttribute("click_source"))for(var s=a[n].getElementsByTagName("a"),l=0;l<s.length;l++)s[l].setAttribute("click_source",a[n].getAttribute("click_source"));var c=this,h=e?e:"http://www.kaikeba.com/";$.getJSON("http://dashboard.kaikeba.com/Handler/userclick_heatmap.ashx?page="+h+"&callback=?",o)},KKB.pageMapMonitor.view.prototype.refresh=function(t){var e=this;return t?void(this.needRefresh=!0):(this.needRefresh=!1,this.myChart&&this.myChart.dispose&&this.myChart.dispose(),this.myChart=this.echarts.init(this.domMain,this.curTheme),window.onresize=this.myChart.resize,new Function(e.setInit(e.getPageArea(),e.trimData))(),void this.myChart.setOption(this.option,!0))},KKB.pageMapMonitor.view.prototype.requireCallback=function(t){monitorObj.curTheme={},monitorObj.echarts=t,monitorObj.refresh(),window.onresize=monitorObj.myChart.resize},KKB.pageMapMonitor.view.prototype.getPageArea=function(){return"BackCompat"==document.compatMode?{W:Math.max(document.body.scrollWidth,document.body.clientWidth),H:Math.max(document.body.scrollHeight,document.body.clientHeight)}:{W:Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth),H:Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)}},KKB.pageMapMonitor.view.prototype.getElementLeft=function(t){for(var e=t.offsetLeft,o=t.offsetParent;null!==o;)e+=o.offsetLeft,o=o.offsetParent;return e},KKB.pageMapMonitor.view.prototype.getElementTop=function(t){for(var e=t.offsetTop,o=t.offsetParent;null!==o;)e+=o.offsetTop,o=o.offsetParent;return e},KKB.pageMapMonitor.view.prototype.getElemPos=function(t){var e={top:0,left:0};if(t.offsetParent)for(;t.offsetParent;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;else t.x?e.left+=t.x:t.x&&(e.top+=t.y);return{x:e.left,y:e.top}},KKB.pageMapMonitor.view.prototype.getElementPosition=function(t,e){var o,r;if("relative"==e)o=this.getBoundingClientRect().left,r=this.getBoundingClientRect().top;else var o=this.getBoundingClientRect().left+document.documentElement.scrollLeft,r=this.getBoundingClientRect().top+document.documentElement.scrollTop;return[o,r]},KKB.pageMapMonitor.view.prototype.strLength=function(t){for(var e=0,o=t.length,r=-1,i=0;o>i;i++)r=t.charCodeAt(i),e+=r>=0&&128>=r?1:2;return e},KKB.pageMapMonitor.view.prototype.setInit=function(t,e){function o(t){var e="\u3010"+t.type+"\u3011";"undefined"!=typeof t.seriesIndex&&(e+="  seriesIndex : "+t.seriesIndex,e+="  dataIndex : "+t.dataIndex),"hover"==t.type?r.itemCover(t.data.W,t.data.H,t.data.y,t.data.x):window.location.href=t.data.HREF}var r=this;this.option={backgroundColor:"rgba(0,0,0,0)",title:{text:"\u5f00\u8bfe\u5427",subtext:"\u7f51\u7ad9\u70b9\u51fb\u70ed\u56fe",x:"center",y:"top"},dataRange:{min:0,max:Math.max.apply(null,r.trimDataVal),y:"top",x:"right",calculable:!0,color:["#ff3333","orange","yellow","lime","aqua"],text:["\u9ad8","\u4f4e"],textStyle:{color:"#fff"}},tooltip:{show:!1,trigger:"item",axisPointer:{shadowStyle:{size:"300",color:"rgba(150,150,150,1)"}}},grid:{x:0,y:0,x2:0,y2:0,backgroundColor:"rgba(0,0,0,0.3)",borderWidth:0,width:t.W,height:t.H},xAxis:[{type:"value",power:1,precision:2,scale:!1,splitNumber:1,axisLine:{show:!1,lineStyle:{color:"#48b",width:1,type:"solid"},onZero:!1},position:"top",min:0,max:t.W,axisLabel:{show:!1,rotate:-90}}],yAxis:[{type:"value",power:1,precision:2,scale:!1,splitLine:!1,axisLine:!1,splitArea:{areaStyle:{color:["rgba(250,250,250,0)","rgba(0,0,0,0)"]}}}],series:[{name:"\u70b9\u51fb\u70ed\u56fe",type:"scatter",data:[[0,0]],markPoint:{symbol:"emptyCircle",symbolSize:function(t){return 10+t/1e3},effect:{show:!0,shadowBlur:0},itemStyle:{normal:{label:{show:!1}}},data:e}}]};var i=require("echarts/config");this.myChart.on(i.EVENT.CLICK,o),this.myChart.on(i.EVENT.HOVER,o)},KKB.pageMapMonitor.view.prototype.itemCover=function(t,e,o,r){var i=document.getElementById("itemCover");if(!i){var a=document.createElement("div");a.style.height="0px",a.style.width="0px",a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.style.background="rgba(200, 54, 54, 0.2)",a.style.zIndex=10001,a.id="itemCover",document.getElementById("monitorContainer").appendChild(a)}i&&(i.style.width=t+"px",i.style.height=e+"px",i.style.top=50==o?0:o+"px",i.style.left=50==r?0:r+"px")};var monitorObj;document.onreadystatechange=function(){function t(t,e){var o="";if(-1==t.indexOf("?"))return t;o=t.substr(t.indexOf("?")+1);var r="",a="";if(-1!=o.indexOf("&")){r=o.split("&");for(i in r)r[i].split("=")[0]!=e&&(a=a+r[i].split("=")[0]+"="+r[i].split("=")[1]+"&");return t.substr(0,t.indexOf("?"))+"?"+a.substr(0,a.length-1)}return r=o.split("="),r[0]==e?t.substr(0,t.indexOf("?")):t}function e(t){for(var e=document.cookie.split("; "),o=0;o<e.length;o++){var r=e[o].split("=");if(r[0]==t)return unescape(r[1])}}var o=window.location.href;getQueryString("checkUrl")&&(document.cookie="checkURL=true",o=t(o,"checkUrl")),"complete"==document.readyState&&e("checkURL")&&(monitorObj=new KKB.pageMapMonitor.view,monitorObj.init(["a","ul"],o))};