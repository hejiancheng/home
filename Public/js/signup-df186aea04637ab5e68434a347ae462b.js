!function(){function e(){var e=$(".tab-mail").find("a");e.click(function(){})}function t(){function e(e,t){$(e).show();var r=60;clearInterval(i),i=setInterval(function(){return 1>=r?($(e).hide().html("60''\u540e\u91cd\u65b0\u53d1\u9001"),$(t).show(),void clearInterval(i)):(r--,void $(e).html(r+"''\u540e\u91cd\u65b0\u53d1\u9001"))},1e3)}var t=$(".tab-mobile").find("button"),r=$("#user_email_or_mobile"),a=t.eq(0),n=t.eq(1);a.click(function(){var t=r.parent().hasClass("status-success"),i=s(r.val());t&&i&&($(this).hide(),e(n,a))});var i=null}function r(){$("#register_form").validate({onkeyup:!1,ignore:"",rules:{"user[username]":{required:!0,username:!0,rangelength:[3,18],remote:{url:"/users/check_username_unique",type:"post",dataType:"json"}},"user[email_or_mobile]":{required:!0,email_or_mobile:!0,remote:{url:"/users/check_email_or_mobile_unique",type:"post",dataType:"json"}},"user[password]":{required:!0,rangelength:[6,16]},"user[captcha]":{required:!0,rangelength:[4,6],remote:{url:"/users/check_mobile_captcha_match",type:"post",dataType:"json"}},"student[name]":{required:!0,student_name:!0},"student[no]":{required:!0,student_name:!0}},messages:{"user[username]":{required:"3-18\u4f4d\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf",username:"3-18\u4f4d\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf",rangelength:"3-18\u4f4d\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf",remote:"\u8be5\u7528\u6237\u540d\u5df2\u7ecf\u5b58\u5728"},"user[email_or_mobile]":{required:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1/\u624b\u673a",email_or_mobile:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1/\u624b\u673a",remote:"\u8be5\u90ae\u7bb1\u5df2\u7ecf\u88ab\u6ce8\u518c"},"user[password]":{required:"6-16\u4f4d\u6570\u5b57\u3001\u5b57\u6bcd\u6216\u7b26\u53f7\u7684\u7ec4\u5408",rangelength:"6-16\u4f4d\u6570\u5b57\u3001\u5b57\u6bcd\u6216\u7b26\u53f7\u7684\u7ec4\u5408"},"user[captcha]":{required:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801",rangelength:"4-6\u4f4d\u6570\u5b57\u3001\u5b57\u6bcd",remote:"\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e"},"student[name]":{required:"\u5b66\u751f\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a",student_name:"\u8bf7\u586b\u5199\u6b63\u786e\u59d3\u540d"},"student[no]":{required:"\u5b66\u751f\u5b66\u53f7\u4e0d\u80fd\u4e3a\u7a7a",student_name:"\u8bf7\u586b\u5199\u6b63\u786e\u59d3\u540d"}},highlight:function(e){$(e).parent().addClass("status-error").removeClass("status-success")},unhighlight:function(e){$(e).parent().removeClass("status-error").addClass("status-success"),e==$("#txt-code")[0]},errorPlacement:function(e,t){$(t).parent().find(".error-block").append(e)}})}function a(){function e(e,t){var r=$(e).val();if(s(r)||""==r)$(e).next().removeClass("bg-mail"),a();else{$(e).next().addClass("bg-mail");var n=r.indexOf("@");if(n>-1){if(13==t)return!1;var o=r.substring(n),l=r.substring(0,n);-1==n&&(l=r,o="@"),u.hide();var c=u.filter(":has(a[format^='"+o+"'])");if(0==c.length)return void a();c.each(function(){var e=$(this).find("a");e.html(l+e.attr("format"))}).show(),i.show()}}}function t(e,t,s){var n=t.filter(":visible"),i=n.length;if(0==i)return!0;var u=n.filter(".active").eq(0),o=u.length,l=o>0,c=r(n,u);if(38==e)l?c>0&&(t.removeClass("active"),n.eq(c-1).addClass("active")):n.eq(0).addClass("active");else if(40==e)l?i-1>c&&(t.removeClass("active"),n.eq(c+1).addClass("active")):n.eq(0).addClass("active");else{if(13!=e)return!0;l&&($(s).val(u.eq(0).find("a").html()),a())}return!1}function r(e,t){for(var r=e.length,a=0;r>a;a++)if($(e[a]).get(0)==$(t).get(0))return a;return-1}function a(){i.hide(),u.removeClass("active")}function n(e){var t=$(e).val();s(t)?$(".form-group:last").removeClass("switch-mail"):($("#refresh_captcha_button").trigger("click"),$(".form-group:last").addClass("switch-mail")),$(".form-group:last").removeClass("status-error")}var i=$(".dropdown-menu"),u=i.find("li"),o=$("#user_email_or_mobile");u.mousedown(function(){var e=$(this).find("a").html();o.val(e).focus(),o.parent().addClass("status-success"),setTimeout(function(){a()},100)}),o.keyup(function(t){e(this,t.keyCode)}).blur(function(){$(this).parent().hasClass("status-success")&&n(this),setTimeout(function(){a()},100)}).keydown(function(e){var r=$(this).val(),a=r.indexOf("@");if(a>-1){var s=e.keyCode,n=t(s,u,this);return n}return!0}),n($("#user_email_or_mobile"))}function s(e){return/^\d+$/.test(e)}$.validator.addMethod("email_or_mobile",function(e){var t=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,4}$/i.test(e),r=/^1\d{10}$/.test(e);return t||r}),$(function(){r(),a(),t(),e()})}();